import Head from 'next/head'
import { signIn, signOut, useSession, getSession  } from "next-auth/client";
import axios from 'axios';
import { useRouter } from "next/router";
import Image from 'next/image';
export default function Home() {

  const [session, loading] = useSession();

  const router = useRouter();

  const handleSubmit = async (e, val) => {
    e.preventDefault()
    console.log(val)

    const url = 'http://localhost:3000/api/user-detail';
    const payload = { params: { val }}
    const response = await axios.get(url, payload)
    if(response.data){
      console.log(response.data[0].key)
    }

    window.$key = response.data[0].key;

    router.push('/add-script');
    
  }

  return (
    <div>
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

 <main>
        {!session && (
          <>
             Not signed in <br />
             {/* <button onClick={signIn}>Sign In</button> */}
           </>
        )}
        {session && (
          <>
             <header>
        <nav className="main-nav">
          <div className="nav-wrapper">
            <div className="logo-wrapper">
               <Image src="/assets/images/logo.svg" width={10} height={10} alt="" />
            </div>
            <div className="right-side">
              <div className="search-bar-wrapper">
                 <Image src="/assets/images/search-icon.png" width={10} height={10} alt="" />
                <input type="text" placeholder="Search" name id />
              </div>
              <span className="notifi">
                 <Image src="/assets/images/notifi.png" width={10} height={10} alt="" />
              </span>
              <a >
                <div className="profile-wrap">
                  <div className="profile-img">
                     <Image src="/assets/images/profile.jpg" width={10} height={10} alt="" />
                  </div>
                  <div className="profile-det">
                    <h5 className="name">
                    {session.user.email}
                    </h5>
                    <p className="desig">CEO</p>
                  </div>
                </div>
              </a>
            </div>
          </div>
        </nav>
      </header>
      <form id="contact" action="#">
        <div>
          <ul className="d-flex steps-wrap" style={{height: '8px'}}>
            <li className="active" />
            <li />
          </ul>
          <section>
            <div className="sec-wrapper">
              <div className="container">
                <div className="row justify-content-center">
                  <div className="col-12 mt-100">
                    <div className="heading">
                      <h3 className="title">Add Hypertarget to your HTML Website</h3>
                      <p className="sub">It’s the only time you’ll be asked to use code.</p>
                    </div>
                    <div className="con-area">
                      <div className="block-wrap">
                        <a onClick={(e) => handleSubmit(e, session.user.email)} >
                          <div className="block animate__animated animate__fadeInUp">
                            <div className="icon">
                               <Image src="/assets/images/icon1.svg" width={10} height={10} alt="" />
                            </div>
                            <p>
                              I’m Ready to Add The
                              Tracking Code
                            </p>
                          </div></a>
                        <div className="block animate__animated animate__fadeInUp">
                          <div className="icon">
                             <Image src="/assets/images/icon2.svg" width={10} height={10} alt="" />
                          </div>
                          <p>
                            Send Installation
                            Instructions Via Email
                          </p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>
        </div>
      </form>
          </>
        )}
      </main>

     
    </div>
  )
}
